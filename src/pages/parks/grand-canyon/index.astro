---
import fs from "node:fs";
import path from "node:path";

import Layout from "../../../layouts/Layout.astro";
import LightboxGallery from "../../../components/LightboxGallery.astro";
import PhotoSwipeInit from "../../../components/PhotoSwipeInit.jsx";
import { getPublicImageSize } from "../../../lib/imageMeta.js";

const park = {
  name: "Grand Canyon National Park",
  location: "Arizona",
  yearVisited: 2013,
  hero: "/images/parks/grandcanyon.jpg",
  subtitle: "Layered rock and canyon light that changes by the minute.",
  description: ` This was the first national park we visited!  
  It was almost just like in the movie "Vacation" where the Griswolds get out of the car, 
   take a quick look and then get back in the car and keep going.  
  We were driving from Colorado to LA and stopped at the Grand Canyon along the way.  
  We only had one afternoon so we drove to as many lookout points as we could before the sun went down.  
  It is truly a beautiful place and takes your breath away to see it.`.trim(),
  howToGetThere: {
    airport: "Phoenix Sky Harbor (PHX)",
    notes: "Rent a car — it's about a 3.5 hour drive north.",
  },
  placesToStay: [
    { label: "We spent the night in Flagstaff, AZ which is closer.", url: "https://www.airbnb.com/s/Flagstaff--AZ/" },
  ],
};

const galleryId = "grand-canyon-gallery";

const galleryDir = path.join(
  process.cwd(),
  "public",
  "images",
  "parks",
  "grand-canyon"
);

const photoFiles = fs
  .readdirSync(galleryDir)
  .filter((name) => !name.startsWith("."))
  .filter((name) => /\.(jpe?g|png|webp)$/i.test(name));

const photos = (
  await Promise.all(
    photoFiles.map(async (filename) => {
      const src = `/images/parks/grand-canyon/${filename}`;
      const { width, height, dateTaken } = await getPublicImageSize(src);

      return { src, width, height, dateTaken, title: filename, alt: filename };
    })
  )
).sort((a, b) => {
  if (a.dateTaken === null && b.dateTaken === null) return 0;
  if (a.dateTaken === null) return 1;
  if (b.dateTaken === null) return -1;
  return a.dateTaken - b.dateTaken;
});
---

<Layout title={park.name}>
  <!-- Park Hero -->
  <section class="park-hero">
    <div
      class="park-hero__image"
      style={`background-image: url('${park.hero}');`}
    ></div>
    <div class="park-hero__overlay"></div>

    <div class="container park-hero__content">
      <p class="park-hero__kicker">{park.location} · {park.yearVisited}</p>
      <h1 class="park-hero__title">{park.name}</h1>
      <p class="park-hero__subtitle">{park.subtitle}</p>

      <div class="park-hero__actions">
        <a class="button button--primary" href="#gallery">View Gallery</a>
        <a class="button button--ghost" href="/parks">← All Parks</a>
      </div>
    </div>
  </section>

  <!-- Intro -->
  <section class="park-intro">
    <div class="container">
      <div class="park-intro__card">
        <h2>About this visit</h2>
        <p>{park.description}</p>

        <h3>How to get there</h3>
        <p><strong>Fly into:</strong> {park.howToGetThere.airport}</p>
        <p>{park.howToGetThere.notes}</p>

        <h3>Places to stay</h3>
        <ul>
          {park.placesToStay.map((place) => (
            <li><a href={place.url} target="_blank" rel="noopener">{place.label}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- Gallery -->
  <section class="park-gallery" id="gallery">
    <div class="container">
      <div class="park-gallery__header">
        <h2>Gallery</h2>
        <p>Click any photo to open a fullscreen viewer with left/right navigation.</p>
      </div>

      <LightboxGallery photos={photos} galleryId={galleryId} />
      <PhotoSwipeInit client:load galleryId={galleryId} />

      <div class="park-gallery__footer">
        <a class="button button--ghost" href="/parks">← Back to All Parks</a>
      </div>
    </div>
  </section>
</Layout>
