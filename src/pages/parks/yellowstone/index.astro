---
import fs from "node:fs";
import path from "node:path";

import Layout from "../../../layouts/Layout.astro";
import LightboxGallery from "../../../components/LightboxGallery.astro";
import PhotoSwipeInit from "../../../components/PhotoSwipeInit.jsx";
import { getPublicImageSize } from "../../../lib/imageMeta.js";

const park = {
  name: "Yellowstone National Park",
  location: "Wyoming",
  yearVisited: 2014,
  hero: "/images/parks/yellowstone.jpg",
  subtitle: "Geysers, hot springs, and wildlife on a volcanic plateau.",
  description: `Our trip to Yellowstone felt like our first "real" National Park trip.  We stayed at Jackson Hole,
  Wyoming for a week and we're able to have to spend many days visiting Yellowstone and Grand Tetons.
    Yellowstone really is a magical place. So many speical things like all of the geysers, geologic pools, in addition 
    to all the the landscape, rivers, waterfalls and wildlife.  It is a top 3 park for sure.`.trim(),
  howToGetThere: {
    airport: "Jackson Hole (JAC)",
    notes: "Rent a car — it's about a 2 hour drive north on US-89.",
  },
  placesToStay: [
    { label: "We found an AirBNB in Jackson Hole, Wyoming.", url: "https://www.airbnb.com/s/Jackson-Hole--WY/" },
  ],
};

const galleryId = "yellowstone-gallery";

const galleryDir = path.join(
  process.cwd(),
  "public",
  "images",
  "parks",
  "yellowstone"
);

const photoFiles = fs
  .readdirSync(galleryDir)
  .filter((name) => !name.startsWith("."))
  .filter((name) => /\.(jpe?g|png|webp)$/i.test(name));

const photos = (
  await Promise.all(
    photoFiles.map(async (filename) => {
      const src = `/images/parks/yellowstone/${filename}`;
      const { width, height, dateTaken } = await getPublicImageSize(src);

      return {
        src,
        width,
        height,
        dateTaken,
        title: filename,
        alt: filename,
      };
    })
  )
).sort((a, b) => {
  if (a.dateTaken === null && b.dateTaken === null) return 0;
  if (a.dateTaken === null) return 1;  // nulls last
  if (b.dateTaken === null) return -1;
  return a.dateTaken - b.dateTaken;
});
---

<Layout title={park.name}>
  <!-- Park Hero -->
  <section class="park-hero">
    <div
      class="park-hero__image"
      style={`background-image: url('${park.hero}');`}
    ></div>
    <div class="park-hero__overlay"></div>

    <div class="container park-hero__content">
      <p class="park-hero__kicker">{park.location} · {park.yearVisited}</p>
      <h1 class="park-hero__title">{park.name}</h1>
      <p class="park-hero__subtitle">{park.subtitle}</p>

      <div class="park-hero__actions">
        <a class="button button--primary" href="#gallery">View Gallery</a>
        <a class="button button--ghost" href="/parks">← All Parks</a>
      </div>
    </div>
  </section>

  <!-- Intro -->
  <section class="park-intro">
    <div class="container">
      <div class="park-intro__card">
        <h2>About this visit</h2>
        <p>{park.description}</p>

        <h3>How to get there</h3>
        <p><strong>Fly into:</strong> {park.howToGetThere.airport}</p>
        <p>{park.howToGetThere.notes}</p>

        <h3>Places to stay</h3>
        <ul>
          {park.placesToStay.map((place) => (
            <li><a href={place.url} target="_blank" rel="noopener">{place.label}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- Gallery -->
  <section class="park-gallery" id="gallery">
    <div class="container">
      <div class="park-gallery__header">
        <h2>Gallery</h2>
        <p>Click any photo to open a fullscreen viewer with left/right navigation.</p>
      </div>

      <LightboxGallery photos={photos} galleryId={galleryId} />
      <PhotoSwipeInit client:load galleryId={galleryId} />

      <div class="park-gallery__footer">
        <a class="button button--ghost" href="/parks">← Back to All Parks</a>
      </div>
    </div>
  </section>
</Layout>
